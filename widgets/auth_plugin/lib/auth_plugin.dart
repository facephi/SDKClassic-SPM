import 'dart:async';
import 'dart:convert';

import 'package:auth_plugin/auth_service.dart';
import 'package:auth_plugin/data/auth_response.dart';
import 'package:chopper/chopper.dart';

class AuthPlugin {
  AuthPlugin(this.service);

  AuthService service;

  Future<AuthResponse> getToken() async {
    Response<String> response = await service.getToken(
        'openid', 'client_credentials');
    print("-------> Auth: getToken. Response: ${response.bodyString}");

    /*
    Example response:
    {"access_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ1QjFlRjdaLUY5ZlBlQzJEcDdkcDFtVUM1V1lmaC00SFBjd0Z0aEtpdmhvIn0.eyJleHAiOjE2MzkxMjk4MjgsImlhdCI6MTYzOTEyOTUyOCwianRpIjoiZGYzZDViOTItNjgzNy00ZDQwLTkwMTMtZWJkNmVmNDMzOTg3IiwiaXNzIjoiaHR0cHM6Ly9hdXRoLmNlbnRyYWxzZXJ2aWNlcy5mYWNlcGhpLmRldi9hdXRoL3JlYWxtcy9pbnBoaW5pdGUiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiNzE2N2ExMjQtNWM0NS00MzIyLWJkMzUtZjYwZjA2Y2Q2MjZlIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoic2RrLW1vYmlsZSIsImFjciI6IjEiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsiZGVmYXVsdC1yb2xlcy1pbnBoaW5pdGUiLCJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIl19LCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgcHJvZmlsZSIsImNsaWVudEhvc3QiOiIxOTIuMTY4LjczLjIzNyIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwiY2xpZW50SWQiOiJzZGstbW9iaWxlIiwicHJlZmVycmVkX3VzZXJuYW1lIjoic2VydmljZS1hY2NvdW50LXNkay1tb2JpbGUiLCJjbGllbnRBZGRyZXNzIjoiMTkyLjE2OC43My4yMzcifQ.b4drDHKwVw2C4wlPY99b-12d8hubQ6ZxlEzFynoinvgikMll8zdKPe8MUqVFIxxa8pTKTwbxp7hTvwA37G-cYsFpMa3_e5iR1kV9usx5qzmCBRxnKk3a9w1QQYQs7D9oZf68fqdx7Efuf8Qx-GPFKJdvF8hd3DA3ZDgforU0Hms6OIqNJMll0gsiu64KJBgD1yXL0lu47XYOg0OSiehPZls9t7nS0ExYj-5fyi--N6bNMWhkuyhQAX4budgVGEp8WVHsnLryw09qbdd5Jtj-585sa82KQtwRNl2js9-tkvI6DEidh0FaFCqarJ_yDPuV6d2JEy1ndPjezxFlVhOyPw",
    "expires_in":300,
    "refresh_expires_in":0,
    "token_type":"Bearer",
    "id_token":"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ1QjFlRjdaLUY5ZlBlQzJEcDdkcDFtVUM1V1lmaC00SFBjd0Z0aEtpdmhvIn0.eyJleHAiOjE2MzkxMjk4MjgsImlhdCI6MTYzOTEyOTUyOCwiYXV0aF90aW1lIjowLCJqdGkiOiIwYmU2ODc0OS00NDFlLTRhYjUtOGU5NC0zN2M1NjFlZjUzMTYiLCJpc3MiOiJodHRwczovL2F1dGguY2VudHJhbHNlcnZpY2VzLmZhY2VwaGkuZGV2L2F1dGgvcmVhbG1zL2lucGhpbml0ZSIsImF1ZCI6InNkay1tb2JpbGUiLCJzdWIiOiI3MTY3YTEyNC01YzQ1LTQzMjItYmQzNS1mNjBmMDZjZDYyNmUiLCJ0eXAiOiJJRCIsImF6cCI6InNkay1tb2JpbGUiLCJhdF9oYXNoIjoiS1BCTy1rekRSNm1GYVE3MVk2OWQxdyIsImFjciI6IjEiLCJjbGllbnRIb3N0IjoiMTkyLjE2OC43My4yMzciLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImNsaWVudElkIjoic2RrLW1vYmlsZSIsInByZWZlcnJlZF91c2VybmFtZSI6InNlcnZpY2UtYWNjb3VudC1zZGstbW9iaWxlIiwiY2xpZW50QWRkcmVzcyI6IjE5Mi4xNjguNzMuMjM3In0.YbG-0IvzIZHzkqMdttczG9hEpjnnk-6bw_gsH3bZxRv-ucYl_4C_cgKbGnt0E-dbPgZROTsKV16F1EHJOVdEXsV-0VXQUxXS7raS_I6CWYRb-dlKT8l0gX_U7VYC4DIVnV96__ZQx521nN75p2NsoBc0ST1XguNZoCH9KMwnMKa79v6wiBibNZlmMg2QZrnfyVNRD4QwBZqa9ZHByuXs0wSocUEMaAuao3T37l4M9G1coWrPL4vO9tt18gtLFJ9iMDuhazMXrF6Jpn13ibhfVugeuBD9sQ65Ty48Fr3Zh0xUTfHHiuYSB1OWy8FImnO8xuv49INlFYd2nQqfQuohZg",
    "not-before-policy":0,
    "scope":"openid email profile"}
     */

    return AuthResponse.fromJson(jsonDecode(response.bodyString));
  }

}
